<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

<!--
  <slide class="logoslide nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/google_developers_logo.png"></span>
    </article>
  </slide>
-->
  <slide class="title-slide segue nobackground">
    <aside class="gdbar"><img src="images/shoretel_logo_128.png"></aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>

<slide>
    <hgroup>
      <h2>55 Employees = $19 Billion</h2>
    </hgroup>
    <article class="flexbox vcenter">
      <img style="max-height:100%" src="images/whatsapp.jpg" alt="Description" title="Description" />
      <footer class="source">whatsapp.com</footer>
    </article>
  </slide>

<slide>
    <hgroup>
    </hgroup>
    <article class="flexbox vcenter">
      <img src="images/erlang.svg" alt="Description" title="Description" />
		<h2 class="black">We Told You So&#8482;<h2>
      <footer class="source">erlang.org</footer>
    </article>
  </slide>

  <slide hidden>
    <hgroup>
      <h2>I Come from the Land Down Under</h2>
    </hgroup>
    <article>
      <iframe data-src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=canberra,+Australia&amp;aq=&amp;sll=-35.282,149.128684&amp;sspn=0.014661,0.01929&amp;t=h&amp;ie=UTF8&amp;hq=&amp;hnear=Canberra+Australian+Capital+Territory,+Australia&amp;ll=23.241346,-123.75&amp;;spn=103.190123,149.414063&&amp;z=2&amp;output=embed"></iframe>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>I Come from the Land Down Under</h2>
    </hgroup>
    <article class="flexbox vcenter">
      <img src="images/map.png">
      <footer class="source">maps.google.com</footer>
   </article>
  </slide>


  <slide class="fill nobackground" style="background-image: url(images/canberra.jpg)">
    <hgroup>
      <h2 class="white"></h2>
    </hgroup>
    <footer class="source white">www.canberrayourfuture.com.au/workspace/images/banner-three.jpg</footer>
  </slide>

  <slide class="fill nobackground" style="background-image: url(images/uluru.jpg)">
    <hgroup>
      <h2 class="white"></h2>
    </hgroup>
    <footer class="source white">i.imgur.com/OcWz7.jpg</footer>
  </slide>

  <slide class="fill nobackground" style="background-image: url(images/taipan.jpg)">
    <hgroup>
      <h2 class="white"></h2>
    </hgroup>
    <footer class="source white">upload.wikimedia.org/wikipedia/commons/f/fe/Fierce_Snake-Oxyuranus_microlepidotus.jpg</footer>
  </slide>

  <slide class="fill nobackground" style="background-image: url(images/shark.jpg)">
    <hgroup>
      <h2 class="white"></h2>
    </hgroup>
    <footer class="source black">media.brainz.org/uploads/2011/03/12-great-white.jpg</footer>
  </slide>

  <slide class="fill nobackground" style="background-image: url(images/kangaroo.gif)">
    <hgroup>
      <h2 class="white"></h2>
    </hgroup>
    <footer class="source black">www.nedmartin.org/v3/amused/kangaroo-kicks-boy-into-dam</footer>
  </slide>

  <slide class="fill nobackground" style="background-image: url(images/skywhale.jpg)" hidden>
    <hgroup>
      <h2 class="white"></h2>
    </hgroup>
    <footer class="source white">www.abc.net.au/news/image/4683536-3x2-940x627.jpg</footer>
  </slide>

  <slide>
    <hgroup>
      <h2>ShoreTel Sky</h2>
    </hgroup>
    <article>
      <ul>
        <li>Hosted business phone systems</li>
		  <li>VoIP: Just a phone and an Internet connection on the client side</li>
        <li>Thousands of companies hosted on our servers</li>
		  <li>&gt;10,000 phones per server</li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Legacy Platform</h2>
    </hgroup>
    <article>
      <ul>
        <li>C/C++ code</li>
		  <li>Massively parallel*</li>
        <li>Robust</li>
			<li>Fast in-memory database (home-grown)</li>
		  <li>Surprisingly scalable</li>
      </ul>
	<footer class="source">* Sort of</footer>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Far from Perfect</h2>
    </hgroup>
    <article>
      <ul class="build">
        <li>C/C++ code</li>
        <li>One invalid pointer can take down thousands of phones</li>
        <li>No hot upgrades</li>
        <li>Ever tried to debug a crash in STL?</li>
        <li>State machines are not an easy concurrency model</li>
        <li>Threads are not a practical concurrency model at this scale (in C++)</li>
      </ul>
    </article>
  </slide>

  <slide class="segue dark nobackground">
    <aside class="gdbar"><img src="images/shoretel_logo_128.png"></aside>
    <hgroup class="auto-fadein">
      <h2>Enter Erlang</h2>
      <h3>"Hey, we're not the first people to have these problems!"</h3>
    </hgroup>
  </slide>

  <slide>
    <hgroup>
      <h2>Erlwhat?</h2>
    </hgroup>
    <article>
      <ul class ="build">
        <li>Colleague returned from LCA 2007 raving about Erlang</li>
        <li>Natrually we dismissed him as being a lunatic</li>
			<li>Yet...on the face of it it did seem a good fit:</li>
			<ul><li>Highly concurrent</li>
					<li>Robust</li>
					<li>High level language</li>
					<li>Even had its own distributed in-memory DB</li>
			</ul>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>First Experiment</h2>
      <h3>Elvis TFTP</h3>
    </hgroup>
    <article>
      <ul class ="build">
        <li>Happened to have a small, stand-alone task - a multiplexing TFTP server for Cisco phones</li>
        <li>World didn't end when we started using it in production</li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>PHLEM</h2>
      <h3>The PHone Logic EMulator</h3>
    </hgroup>
    <article>
      <ul class ="build">
         <li>Somehow we'd gotten where we were with no test systems other than real phones</li>
         <li>Initial bit of code was written in "spare time" to emulate a single phone</li>
         <li>I picked it up and with minimal effort made it work for thousands of phones</li>
         <li>Okay, maybe our lunatic was on to something here...</li>
      </ul>
    </article>
  </slide>

  <slide class="fill nobackground" style="background-image: url(images/qantas.jpg)">
    <hgroup>
      <h2 class="white">Spread the Word!</h2>
    </hgroup>
    <footer class="source white">w.minecraft-smp.de/e107_files/public/1366197563_42_FT9337_qantas-747.jpg</footer>
  </slide>

  <slide>
    <hgroup>
      <h2>Convincing the rest of the Team</h2>
    </hgroup>
    <article>
      <ul class ="build">
         <li>Gave talks explaining Erlang from the basics</li>
         <ul>
            <li>What it looks like</li>
            <li>Why it isn't scary</li>
            <li>Why it was a perfect fit for us</li>
         </ul>
         <li>Demonstrated what we'd done so far and <b>how little code it took</b></li>
      </ul>
    </article>
  </slide>


  <slide class="segue dark nobackground">
    <aside class="gdbar"><img src="images/shoretel_logo_128.png"></aside>
    <hgroup class="auto-fadein">
      <h2>Objections</h2>
      <h3>"We shouldn't do this because..."</h3>
    </hgroup>
  </slide>

  <slide class="segue dark quote nobackground">
    <aside class="gdbar right bottom"><img src="images/shoretel_logo_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <q>
        There's no inheritance
      </q>
    </article>
  </slide>

  <slide class="segue dark quote nobackground">
    <aside class="gdbar right bottom"><img src="images/shoretel_logo_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <q>
        No global data at all which is like killing a dog because it has flies
      </q>
    </article>
  </slide>

  <slide class="segue dark quote nobackground">
    <aside class="gdbar right bottom"><img src="images/shoretel_logo_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <q>
        The Law of Leaky Abstraction
      </q>
    </article>
  </slide>

  <slide class="segue dark quote nobackground">
    <aside class="gdbar right bottom"><img src="images/shoretel_logo_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <q>
        Obscure language - NetBSD has more websites than Erlang
      </q>
    </article>
  </slide>

  <slide class="segue dark quote nobackground">
    <aside class="gdbar right bottom"><img src="images/shoretel_logo_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <q>
        If someone likes the syntax, it can be easily [reimplemented] in C++ using operators
      </q>
    </article>
  </slide>

  <slide class="segue dark nobackground">
    <aside class="gdbar"><img src="images/shoretel_logo_128.png"></aside>
    <hgroup class="auto-fadein">
      <h2>Hooking It In</h2>
      <h3>You mean we can't just rewrite everything from scratch?</h3>
    </hgroup>
  </slide>

  <slide>
    <hgroup>
		<h2>So There's All This Pesky Legacy Code...</h2>
		<h3>And for some reason people will be upset if it stops working</h3>
    </hgroup>
    <article>
      <ul class="build">
		  <li>Erlang use initially restricted to new functionality</li>
			<ul><li>Call Recording</li>
				<li>CNAM</li>
				<li>Monitoring</li>
			</ul>
		  <li>Has to interface with the old code</li>
		  <li>Which means it has to talk...</li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Binary Struct-based Protocols</h2>
      <h3>It seemed like such a good idea at the time</h3>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="c++">
typedef struct {
   int id;
   long long key;
   char message[10];
} message_t;
</pre>
<p>Sender</p>
      <pre class="prettyprint" data-lang="c++">
message_t msg = {5, 10, "Hello"};
<b>write(sock, &msg, sizeof(msg));</b>
</pre>
<p>Receiver</p>
<pre class="prettyprint" data-lang="c++">
message_t msg;
<b>read(sock, &msg, sizeof(msg));</b>
</pre>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Erlang Side</h2>
    </hgroup>
    <article>
<p>Receiver</p>
		<pre class="prettyprint" data-lang="erlang">
parse(&lt;&lt;Id:32/signed-little, Key:64/signed-little, Message:(10*8)/bitstring&gt;&gt;) -&gt;
   #message_t{
      id = Id,
      key = Key,
      message = lists:takewhile(fun(A) -&gt; A /= 0 end, bitstring_to_list(Message)}.
</pre>
<p>Sender</p>
		<pre class="prettyprint" data-lang="erlang">
encode(#message_t{id = Id, key = Key, message = Message}) -&gt;
   &lt;&lt;
      Id:32/signed-little,
      Key:64/signed-little,
      (list_to_bitstring(string:substr(Message, 1, 10-1)))/bitstring,
      0:((10 - lists:min([10-1, length(Message)]))*8)
   &gt;&gt;.
	</pre>
    </article>
  </slide>

  <slide>
    <hgroup>
		<h2>Oops</h2>
		<h3>Forgot the padding...</h3>
    </hgroup>
    <article class="smaller">
<p>Receiver</p>
		<pre class="prettyprint" data-lang="erlang">
parse(&lt;&lt;Id:32/signed-little, Key:64/signed-little, Message:(10*8)/bitstring, <b>_Pad:(2*8)</b>&gt;&gt;) -&gt;
   #message_t{
      id = Id,
      key = Key,
      message = lists:takewhile(fun(A) -&gt; A /= 0 end, bitstring_to_list(Message)}.
</pre>
<p>Sender</p>
		<pre class="prettyprint" data-lang="erlang">
encode(#message_t{id = Id, key = Key, message = Message}) -&gt;
   &lt;&lt;
      Id:32/signed-little,
      Key:64/signed-little,
      (list_to_bitstring(string:substr(Message, 1, 10-1)))/bitstring,
      0:((10 - lists:min([10-1, length(Message)]))*8),
      <b>0:(2*8)</b>
   &gt;&gt;.
	</pre>
    </article>
  </slide>

  <slide>
    <hgroup>
		<h2>Oops again</h2>
		<h3>x86_64 pads differently...</h3>
    </hgroup>
    <article class="smaller">
<p>Receiver</p>
		<pre class="prettyprint" data-lang="erlang">
parse(&lt;&lt;Id:32/signed-little, <b>_Pad/(4*8)</b>, Key:64/signed-little, 
      Message:(10*8)/bitstring, <b>_Pad2:(6*8)</b>&gt;&gt;) -&gt;
   #message_t{
      id = Id,
      key = Key,
      message = lists:takewhile(fun(A) -&gt; A /= 0 end, bitstring_to_list(Message)}.
</pre>
<p>Sender</p>
		<pre class="prettyprint" data-lang="erlang">
encode(#message_t{id = Id, key = Key, message = Message}) -&gt;
   &lt;&lt;
      Id:32/signed-little,
      <b>0:(4*8), % Pad to long long boundary</b>
      Key:64/signed-little,
      (list_to_bitstring(string:substr(Message, 1, 10-1)))/bitstring,
      0:((10 - lists:min([10-1, length(Message)]))*8),
      <b>0:(6*8) % Pad to boundary of largest struct memeber</b>
   &gt;&gt;.
	</pre>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Yarn Code Generator</h2>
    </hgroup>
    <article>
      <ul class="build">
        <li>Erlang-like canonical files</li>
        <li>Erlang parser + yecc + erlydtl</li>
        <li>Many output formats:
        <ul>
           <li>Erlang (records, encoders/decoders)</li>
           <li>C++ (structs)</li>
           <li>Java (classes, encoders/decoders)</li>
           <li>Python (DB modification)</li>
           <li>SQL (DB schema and updates)</li>
        </ul>
        </li>
     </ul>
    </article>
  </slide>

  
  <slide>
    <hgroup>
      <h2>Rec files</h2>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="rec">
constant(MESSAGE_SIZE = 10) % length of the message

record(
   message_t {
      id :: integer,
      key :: long_long,
      message :: string : [{max_len, 'MESSAGE_SIZE'}],
})
</pre>
<table> <tr>
	<td>
      <pre class="prettyprint" data-lang="c++">
typedef struct {
   int id;
   long long key;
   char message[10];
} message_t;
		</pre>
	</td>
	<td>
		<pre class="prettyprint" data-lang="erlang">
-record( message_t, {
   id :: integer(),
   key :: integer(),
   message :: string()
}).
</pre>
</td>
</tr></table>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Other Things</h2>
    </hgroup>
    <article>
      <ul class="build">
			<li>Keep your sysadmins happy - use <code>erld</code></li>
			<li>Monitor your system - Erlang's fault tolerance is a blessing and an occasional curse</li>
			<li>Use Dialyzer to catch beginner (and advanced) mistakes</li>
      </ul>
    </article>
  </slide>
  

  <slide>
    <hgroup>
      <h2>Building Acceptance</h2>
      <h3></h3>
    </hgroup>
    <article>
      <p>Start Small:</p>
      <ul class="build">
         <li>Start with non-core elements</li>
         <li>One piece at a time - you're not going to get a year off to rewrite your whole system</li>
         <li>Don't build anything critical first - you <i>will</i> make mistakes</li>
         <li>Erlang is easy<sup>[<u class="blue">citation needed</u>]</sup> but building concurrent, high load, reliable production systems still isn't</li>
      </ul>
    </article>
  </slide>

  <slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="images/shoretel_logo_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <h2>Thank You!</h2>
      <p>Send whiskey to:</p>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>


  <slide class="backdrop"></slide>

</slides>
</body>
</html>
